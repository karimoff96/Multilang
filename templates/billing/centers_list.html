{% extends "layout/layout.html" %}
{% load i18n %}

{% block title %}{% trans "All Centers - Billing" %}{% endblock %}

{% block content %}
<div class="dashboard-main-body">

    <!-- Statistics Cards -->
    <div class="row gy-4 mb-24">
        <div class="col-xxl-4 col-sm-6">
            <div class="card px-24 py-16 shadow-none radius-8 border h-100 bg-gradient-start-1">
                <div class="card-body p-0">
                    <div class="d-flex flex-wrap align-items-center justify-content-between gap-1">
                        <div>
                            <span class="mb-2 fw-medium text-secondary-light text-md">{% trans "Total Centers" %}</span>
                            <h6 class="fw-semibold mb-0">{{ total_centers }}</h6>
                        </div>
                        <div class="w-44 h-44 bg-primary-600 text-white rounded-circle d-flex justify-content-center align-items-center">
                            <iconify-icon icon="mdi:domain" class="text-2xl"></iconify-icon>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xxl-4 col-sm-6">
            <div class="card px-24 py-16 shadow-none radius-8 border h-100 bg-gradient-start-2">
                <div class="card-body p-0">
                    <div class="d-flex flex-wrap align-items-center justify-content-between gap-1">
                        <div>
                            <span class="mb-2 fw-medium text-secondary-light text-md">{% trans "With Subscription" %}</span>
                            <h6 class="fw-semibold mb-0">{{ with_subscription }}</h6>
                        </div>
                        <div class="w-44 h-44 bg-success-main text-white rounded-circle d-flex justify-content-center align-items-center">
                            <iconify-icon icon="solar:check-circle-bold" class="text-2xl"></iconify-icon>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xxl-4 col-sm-6">
            <div class="card px-24 py-16 shadow-none radius-8 border h-100 bg-gradient-start-3">
                <div class="card-body p-0">
                    <div class="d-flex flex-wrap align-items-center justify-content-between gap-1">
                        <div>
                            <span class="mb-2 fw-medium text-secondary-light text-md">{% trans "Without Subscription" %}</span>
                            <h6 class="fw-semibold mb-0">{{ without_subscription }}</h6>
                        </div>
                        <div class="w-44 h-44 bg-warning-main text-white rounded-circle d-flex justify-content-center align-items-center">
                            <iconify-icon icon="solar:danger-triangle-bold" class="text-2xl"></iconify-icon>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Centers Table -->
    <div class="card">
        <div class="card-header d-flex flex-wrap align-items-center justify-content-between gap-3">
            <div class="d-flex flex-wrap align-items-center gap-3">
                <form method="get" class="d-flex align-items-center gap-2">
                    <input type="text" name="search" class="form-control" placeholder="{% trans 'Search centers...' %}" value="{{ search_query }}">
                    <button type="submit" class="btn btn-primary-600">
                        <iconify-icon icon="solar:magnifer-bold"></iconify-icon>
                    </button>
                </form>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table bordered-table mb-0">
                    <thead>
                        <tr>
                            <th>{% trans "ID" %}</th>
                            <th>{% trans "Name" %}</th>
                            <th>{% trans "Subdomain" %}</th>
                            <th>{% trans "Owner" %}</th>
                            <th>{% trans "Subscription Status" %}</th>
                            <th>{% trans "Tariff" %}</th>
                            <th>{% trans "End Date" %}</th>
                            <th>{% trans "Actions" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for center in centers %}
                        <tr>
                            <td>{{ center.id }}</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    {% if center.logo %}
                                    <img src="{{ center.logo.url }}" alt="" class="w-40-px h-40-px rounded-circle me-12 flex-shrink-0">
                                    {% endif %}
                                    <span class="text-md fw-medium">{{ center.name }}</span>
                                </div>
                            </td>
                            <td>
                                <code>{{ center.subdomain }}.multilang.uz</code>
                            </td>
                            <td>{{ center.owner.get_full_name|default:center.owner.username }}</td>
                            <td>
                                {% if center.sub_status == 'active' %}
                                <span class="badge bg-success-600 text-white px-12 py-6">{% trans "Active" %}</span>
                                {% elif center.sub_status == 'expired' %}
                                <span class="badge bg-danger-600 text-white px-12 py-6">{% trans "Expired" %}</span>
                                {% elif center.sub_status == 'pending' %}
                                <span class="badge bg-warning-600 text-white px-12 py-6">{% trans "Pending" %}</span>
                                {% elif center.sub_status == 'cancelled' %}
                                <span class="badge bg-secondary-600 text-white px-12 py-6">{% trans "Cancelled" %}</span>
                                {% else %}
                                <span class="badge bg-neutral-400 text-white px-12 py-6">{% trans "No Subscription" %}</span>
                                {% endif %}
                            </td>
                            <td>{{ center.sub_tariff|default:"-" }}</td>
                            <td>
                                {% if center.sub_end_date %}
                                {{ center.sub_end_date|date:"Y-m-d" }}
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex align-items-center gap-2">
                                    {% if center.sub_status %}
                                    <a href="{% url 'billing:subscription_detail' center.subscription.id %}" 
                                       class="btn btn-sm btn-primary-600 text-white no-hover-effect"
                                       title="{% trans 'View' %}"
                                       data-bs-toggle="tooltip">
                                        <iconify-icon icon="solar:eye-bold"></iconify-icon>
                                    </a>
                                    {% else %}
                                    <a href="{% url 'billing:subscription_create' center.id %}" 
                                       class="btn btn-sm btn-success-600 text-white no-hover-effect"
                                       title="{% trans 'Create' %}"
                                       data-bs-toggle="tooltip">
                                        <iconify-icon icon="solar:add-circle-bold"></iconify-icon>
                                    </a>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" class="text-center py-4">
                                <p class="text-secondary-light">{% trans "No centers found." %}</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            {% if centers.has_other_pages %}
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mt-24">
                <span class="text-secondary-light text-sm">
                    {% trans "Showing" %} {{ centers.start_index }} {% trans "to" %} {{ centers.end_index }} {% trans "of" %} {{ centers.paginator.count }}
                </span>
                <ul class="pagination d-flex flex-wrap align-items-center gap-2 justify-content-center">
                    {% if centers.has_previous %}
                    <li class="page-item">
                        <a class="page-link text-secondary-light fw-medium radius-4 border-0 px-10 py-10 d-flex align-items-center justify-content-center h-32-px w-32-px bg-base" 
                           href="?page={{ centers.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                            <iconify-icon icon="ep:d-arrow-left" class="text-xl"></iconify-icon>
                        </a>
                    </li>
                    {% endif %}
                    
                    {% for num in centers.paginator.page_range %}
                        {% if centers.number == num %}
                        <li class="page-item active">
                            <span class="page-link bg-primary-600 text-white fw-medium radius-4 border-0 px-10 py-10 d-flex align-items-center justify-content-center h-32-px w-32-px">{{ num }}</span>
                        </li>
                        {% elif num > centers.number|add:'-3' and num < centers.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link text-secondary-light fw-medium radius-4 border-0 px-10 py-10 d-flex align-items-center justify-content-center h-32-px w-32-px bg-base" 
                               href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ num }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if centers.has_next %}
                    <li class="page-item">
                        <a class="page-link text-secondary-light fw-medium radius-4 border-0 px-10 py-10 d-flex align-items-center justify-content-center h-32-px w-32-px bg-base" 
                           href="?page={{ centers.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                            <iconify-icon icon="ep:d-arrow-right" class="text-xl"></iconify-icon>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

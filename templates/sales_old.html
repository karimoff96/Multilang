{% extends './layout/layout.html' %} 
    

{% block content %}
<div class="row gy-4 mt-1">
    <div class="col-12">
        <div class="card h-100 border shadow-none">
            <div class="card-body">
                <div class="d-flex flex-wrap align-items-center justify-content-between">
                    <h6 class="text-lg mb-0">Orders</h6>
                    <select class="form-select form-select-sm w-auto" id="ordersPeriodSelect">
                        <option value="yearly" selected>Yearly</option>
                        <option value="monthly">Monthly</option>
                        <option value="weekly">Weekly</option>
                        <option value="today">Today</option>
                    </select>
                </div>
                <div class="d-flex flex-wrap align-items-center gap-2 mt-8">
                    <h6 class="mb-0" id="ordersRevenue">{{ yearly_revenue|floatformat:0 }} UZS</h6>
                    <span class="text-sm fw-semibold rounded-pill px-8 py-4 line-height-1 border" id="ordersChangeBadge">
                        <span id="ordersChangeValue">{{ yearly_change }}%</span>
                        <iconify-icon icon="bxs:up-arrow" class="text-xs" id="ordersChangeIcon"></iconify-icon>
                    </span>
                    <span class="text-xs fw-medium" id="ordersDailyAvg">+ {{ yearly_daily_avg|floatformat:0 }} UZS Per Day</span>
                </div>
                <div class="d-flex align-items-center gap-2 mt-2">
                    <span class="text-secondary-light text-sm">Total Orders: <strong id="ordersCount">{{ yearly_count }}</strong></span>
                </div>
                <div id="chart" class="pt-28 apexcharts-tooltip-style-1"></div>
            </div>
        </div>
    </div>
        <div class="col-xxl-4 col-lg-6">
        <div class="card h-100 border shadow-none radius-8 overflow-hidden">
            <div class="card-body p-24">
                <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between">
                    <h6 class="mb-2 fw-bold text-lg">Orders by statuses</h6>
                    <div class="">
                        <select class="form-select form-select-sm w-auto bg-base border text-secondary-light" id="statusPeriodSelect">
                            <option value="today">Today</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly" selected>Yearly</option>
                        </select>
                    </div>
                </div>

                <div id="orderStatusDonutChart"></div>

                <ul class="d-flex flex-wrap align-items-center justify-content-center mt-3 gap-3" id="statusLegend">
                    <!-- Legend will be dynamically populated -->
                </ul>

            </div>
        </div>
    </div>
   
    <!-- Earning Static start -->
    <div class="col-xxl-8 col-lg-6">
        <div class="card h-100 border shadow-none radius-8 border-0">
            <div class="card-body p-24">
                <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between">
                    <div>
                        <h6 class="mb-2 fw-bold text-lg">Earning Statistic</h6>
                        <span class="text-sm fw-medium text-secondary-light">Yearly earning overview</span>
                    </div>
                    <div class="">
                        <select class="form-select form-select-sm w-auto bg-base border text-secondary-light">
                            <option>Yearly</option>
                            <option>Monthly</option>
                            <option>Weekly</option>
                            <option>Today</option>
                        </select>
                    </div>
                </div>

                <div class="mt-20 d-flex justify-content-center flex-wrap gap-3">

                    <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="fluent:cart-16-filled" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium">Sales</span>
                            <h6 class="text-md fw-semibold mb-0">$200k</h6>
                        </div>
                    </div>

                    <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="uis:chart" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium">Income</span>
                            <h6 class="text-md fw-semibold mb-0">$200k</h6>
                        </div>
                    </div>

                    <div class="d-inline-flex align-items-center gap-2 p-2 radius-8 border pe-36 br-hover-primary group-item">
                        <span class="bg-neutral-100 w-44-px h-44-px text-xxl radius-8 d-flex justify-content-center align-items-center text-secondary-light group-hover:bg-primary-600 group-hover:text-white">
                            <iconify-icon icon="ph:arrow-fat-up-fill" class="icon"></iconify-icon>
                        </span>
                        <div>
                            <span class="text-secondary-light text-sm fw-medium">Profit</span>
                            <h6 class="text-md fw-semibold mb-0">$200k</h6>
                        </div>
                    </div>
                </div>

                <div id="barChart"></div>
            </div>
        </div>
    </div>
    <!-- Earning Static End -->
{% comment %} Top 5 Agencies and Customers {% endcomment %}
    <!-- Top Agencies Table -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <h5 class="card-title mb-0">Top 5 Agencies</h5>
                <select class="form-select form-select-sm w-auto" id="agenciesPeriodSelect">
                    <option value="yearly" selected>Yearly</option>
                    <option value="monthly">Monthly</option>
                    <option value="weekly">Weekly</option>
                    <option value="today">Today</option>
                </select>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th scope="col" class="bg-base">#</th>
                                <th scope="col" class="bg-base">Agency</th>
                                <th scope="col" class="bg-base">Orders</th>
                                <th scope="col" class="bg-base">Total Spent</th>
                                <th scope="col" class="bg-base">Pages</th>
                            </tr>
                        </thead>
                        <tbody id="agenciesTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                    <div id="noAgenciesMessage" class="text-center text-secondary-light py-4 d-none">
                        No agencies found for this period
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Top Customers Table -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <h5 class="card-title mb-0">Top 5 Customers</h5>
                <select class="form-select form-select-sm w-auto" id="customersPeriodSelect">
                    <option value="yearly" selected>Yearly</option>
                    <option value="monthly">Monthly</option>
                    <option value="weekly">Weekly</option>
                    <option value="today">Today</option>
                </select>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th scope="col" class="bg-base">#</th>
                                <th scope="col" class="bg-base">Customer</th>
                                <th scope="col" class="bg-base">Orders</th>
                                <th scope="col" class="bg-base">Total Spent</th>
                                <th scope="col" class="bg-base">Pages</th>
                            </tr>
                        </thead>
                        <tbody id="customersTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                    <div id="noCustomersMessage" class="text-center text-secondary-light py-4 d-none">
                        No customers found for this period
                    </div>
                </div>
            </div>
        </div>
    </div>
    
 <!-- Client Payment Status Start -->
    <div class="col-xxl-4 col-lg-6">
        <div class="card h-100 border shadow-none radius-8 border-0">
            <div class="card-body p-24">
                <h6 class="mb-2 fw-bold text-lg">Client Payment Status</h6>
                <span class="text-sm fw-medium text-secondary-light">Weekly Report</span>

                <ul class="d-flex flex-wrap align-items-center justify-content-center mt-32">
                    <li class="d-flex align-items-center gap-2 me-28">
                        <span class="w-12-px h-12-px rounded-circle bg-success-main"></span>
                        <span class="text-secondary-light text-sm fw-medium">Paid: 500</span>
                    </li>
                    <li class="d-flex align-items-center gap-2 me-28">
                        <span class="w-12-px h-12-px rounded-circle bg-info-main"></span>
                        <span class="text-secondary-light text-sm fw-medium">Pending: 500</span>
                    </li>
                    <li class="d-flex align-items-center gap-2">
                        <span class="w-12-px h-12-px rounded-circle bg-warning-main"></span>
                        <span class="text-secondary-light text-sm fw-medium">Overdue: 1500</span>
                    </li>
                </ul>
                <div class="mt-40">
                    <div id="paymentStatusChart" class="margin-16-minus"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Client Payment Status End -->


    <!-- Total Transactions Start -->
    <div class="col-xxl-4 col-lg-6">
        <div class="card h-100 border shadow-none">
            <div class="card-body p-24">
                <div class="d-flex align-items-center flex-wrap gap-2 justify-content-between mb-20">
                    <h6 class="mb-2 fw-bold text-lg">Total Transactions </h6>
                    <div class="">
                        <select class="form-select form-select-sm w-auto bg-base border text-secondary-light">
                            <option>Yearly</option>
                            <option>Monthly</option>
                            <option>Weekly</option>
                            <option>Today</option>
                        </select>
                    </div>
                </div>

                <ul class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-28">
                    <li class="d-flex align-items-center gap-2">
                        <span class="w-16-px h-16-px radius-2 bg-primary-600"></span>
                        <span class="text-secondary-light text-lg fw-normal">
                            Total Gain:
                            <span class="text-primary-light fw-bold text-lg">$50,000</span>
                        </span>
                    </li>
                </ul>

                <div id="transactionLineChart"></div>

            </div>
        </div>
    </div>
    <!-- Total Transactions End -->
    <!-- Statistics Start -->
    <div class="col-xxl-4 col-lg-6">
        <div class="card h-100 radius-8 border-0">
            <div class="card-body p-24">
                <h6 class="mb-2 fw-bold text-lg">Statistic</h6>

                <div class="mt-24">
                    <div class="d-flex align-items-center gap-1 justify-content-between mb-44">
                        <div>
                            <span class="text-secondary-light fw-normal mb-12 text-xl">Daily Conversions</span>
                            <h5 class="fw-semibold mb-0">%60</h5>
                        </div>
                        <div class="position-relative">
                            <div id="semiCircleGauge"></div>

                            <span class="w-36-px h-36-px rounded-circle bg-neutral-100 d-flex justify-content-center align-items-center position-absolute start-50 translate-middle bottom-0">
                                <iconify-icon icon="mdi:emoji" class="text-primary-600 text-md mb-0"></iconify-icon>
                            </span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center gap-1 justify-content-between mb-44">
                        <div>
                            <span class="text-secondary-light fw-normal mb-12 text-xl">Visits By Day</span>
                            <h5 class="fw-semibold mb-0">20k</h5>
                        </div>
                        <div id="areaChart"></div>
                    </div>

                    <div class="d-flex align-items-center gap-1 justify-content-between">
                        <div>
                            <span class="text-secondary-light fw-normal mb-12 text-xl">Today Income</span>
                            <h5 class="fw-semibold mb-0">$5.5k</h5>
                        </div>
                        <div id="dailyIconBarChart"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <!-- Statistics End -->

</div>

{% endblock content %}

{% block script %}
    <script>
    // ================================== Crm Home widgets charts Start =================================
    function createWidgetChart(chartId, chartColor) {

        let currentYear = new Date().getFullYear();

        var options = {
            series: [{
                name: 'series1',
                data: [35, 45, 38, 41, 36, 43, 37, 55, 40],
            },],
            chart: {
                type: 'area',
                width: 100,
                height: 42,
                sparkline: {
                    enabled: true // Remove whitespace
                },

                toolbar: {
                    show: false
                },
                padding: {
                    left: 0,
                    right: 0,
                    top: 0,
                    bottom: 0
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 2,
                colors: [chartColor],
                lineCap: 'round'
            },
            grid: {
                show: true,
                borderColor: 'transparent',
                strokeDashArray: 0,
                position: 'back',
                xaxis: {
                    lines: {
                        show: false
                    }
                },
                yaxis: {
                    lines: {
                        show: false
                    }
                },
                row: {
                    colors: undefined,
                    opacity: 0.5
                },
                column: {
                    colors: undefined,
                    opacity: 0.5
                },
                padding: {
                    top: -3,
                    right: 0,
                    bottom: 0,
                    left: 0
                },
            },
            fill: {
                type: 'gradient',
                colors: [chartColor], // Set the starting color (top color) here
                gradient: {
                    shade: 'light', // Gradient shading type
                    type: 'vertical', // Gradient direction (vertical)
                    shadeIntensity: 0.5, // Intensity of the gradient shading
                    gradientToColors: [`${chartColor}00`], // Bottom gradient color (with transparency)
                    inverseColors: false, // Do not invert colors
                    opacityFrom: .75, // Starting opacity
                    opacityTo: 0.3, // Ending opacity
                    stops: [0, 100],
                },
            },
            // Customize the circle marker color on hover
            markers: {
                colors: [chartColor],
                strokeWidth: 2,
                size: 0,
                hover: {
                    size: 8
                }
            },
            xaxis: {
                labels: {
                    show: false
                },
                categories: [`Jan ${currentYear}`, `Feb ${currentYear}`, `Mar ${currentYear}`, `Apr ${currentYear}`, `May ${currentYear}`, `Jun ${currentYear}`, `Jul ${currentYear}`, `Aug ${currentYear}`, `Sep ${currentYear}`, `Oct ${currentYear}`, `Nov ${currentYear}`, `Dec ${currentYear}`],
                tooltip: {
                    enabled: false,
                },
            },
            yaxis: {
                labels: {
                    show: false
                }
            },
            tooltip: {
                x: {
                    format: 'dd/MM/yy HH:mm'
                },
            },
        };

        var chart = new ApexCharts(document.querySelector(`#${chartId}`), options);
        chart.render();
    }

    // Call the function for each chart with the desired ID and color
    createWidgetChart('new-user-chart', '#487fff');
    createWidgetChart('active-user-chart', '#45b369');
    createWidgetChart('total-sales-chart', '#f4941e');
    createWidgetChart('conversion-user-chart', '#8252e9');
    // ================================== Crm Home widgets charts End =================================

    // ================================== Crm Home widgets charts Start =================================
    function createCoinChart(chartId, chartColor) {

        let currentYear = new Date().getFullYear();

        var options = {
            series: [{
                name: 'series1',
                data: [31, 24, 30, 25, 32, 28, 40, 32, 42, 38, 40, 32, 38, 35, 45],
            },],
            chart: {
                type: 'area',
                width: 150,
                height: 70,

                sparkline: {
                    enabled: true // Remove whitespace
                },

                toolbar: {
                    show: false
                },
                padding: {
                    left: 0,
                    right: 0,
                    top: 0,
                    bottom: 0
                },
                events: {
                    mounted: function (chartContext, config) {
                        // Apply CSS blur to markers
                        document.querySelectorAll(`#${chartId} .apexcharts-marker`).forEach(marker => {
                            marker.style.filter = 'blur(2px)';
                        });
                    },
                    updated: function (chartContext, config) {
                        // Apply CSS blur to markers
                        document.querySelectorAll(`#${chartId} .apexcharts-marker`).forEach(marker => {
                            marker.style.filter = 'blur(3px)';
                        });
                    }
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 2,
                colors: [chartColor],
                lineCap: 'round'
            },
            grid: {
                show: true,
                borderColor: 'transparent',
                strokeDashArray: 0,
                position: 'back',
                xaxis: {
                    lines: {
                        show: false
                    }
                },
                yaxis: {
                    lines: {
                        show: false
                    }
                },
                row: {
                    colors: undefined,
                    opacity: 0.5
                },
                column: {
                    colors: undefined,
                    opacity: 0.5
                },
                padding: {
                    top: -3,
                    right: 0,
                    bottom: 0,
                    left: 0
                },
            },
            fill: {
                type: 'gradient',
                colors: [chartColor], // Set the starting color (top color) here
                gradient: {
                    shade: 'light', // Gradient shading type
                    type: 'vertical', // Gradient direction (vertical)
                    shadeIntensity: 0.5, // Intensity of the gradient shading
                    gradientToColors: [`${chartColor}00`], // Bottom gradient color (with transparency)
                    inverseColors: false, // Do not invert colors
                    opacityFrom: .7, // Starting opacity
                    opacityTo: 0.3, // Ending opacity
                    stops: [0, 100],
                },
            },
            // Customize the circle marker color on hover
            markers: {
                colors: [chartColor],
                strokeWidth: 2,
                size: 0,
                hover: {
                    size: 8
                }
            },
            xaxis: {
                labels: {
                    show: false
                },
                categories: [`Jan ${currentYear}`, `Feb ${currentYear}`, `Mar ${currentYear}`, `Apr ${currentYear}`, `May ${currentYear}`, `Jun ${currentYear}`, `Jul ${currentYear}`, `Aug ${currentYear}`, `Sep ${currentYear}`, `Oct ${currentYear}`, `Nov ${currentYear}`, `Dec ${currentYear}`],
                tooltip: {
                    enabled: false,
                },
            },
            yaxis: {
                labels: {
                    show: false
                }
            },
            tooltip: {
                x: {
                    format: 'dd/MM/yy HH:mm'
                },
            },
        };

        var chart = new ApexCharts(document.querySelector(`#${chartId}`), options);
        chart.render();
    }

    // Call the function for each chart with the desired ID and color
    createCoinChart('bitcoinAreaChart', '#F98C08');
    createCoinChart('ethereumAreaChart', '#5F80FF');
    createCoinChart('solanaAreaChart', '#C817F8');
    createCoinChart('litecoinAreaChart', '#2171EA');
    createCoinChart('dogecoinAreaChart', '#C2A633');
    // ================================== Crm Home widgets charts End =================================

    // Orders data from Django
    const ordersData = {
        yearly: {
            revenue: {{ yearly_revenue|default:0 }},
            count: {{ yearly_count|default:0 }},
            change: {{ yearly_change|default:0 }},
            dailyAvg: {{ yearly_daily_avg|default:0 }},
            chartData: {{ yearly_chart_data|safe }},
            chartLabels: {{ yearly_chart_labels|safe }}
        },
        monthly: {
            revenue: {{ monthly_revenue|default:0 }},
            count: {{ monthly_count|default:0 }},
            change: {{ monthly_change|default:0 }},
            dailyAvg: {{ monthly_daily_avg|default:0 }},
            chartData: {{ monthly_chart_data|safe }},
            chartLabels: {{ monthly_chart_labels|safe }}
        },
        weekly: {
            revenue: {{ weekly_revenue|default:0 }},
            count: {{ weekly_count|default:0 }},
            change: {{ weekly_change|default:0 }},
            dailyAvg: {{ weekly_daily_avg|default:0 }},
            chartData: {{ weekly_chart_data|safe }},
            chartLabels: {{ weekly_chart_labels|safe }}
        },
        today: {
            revenue: {{ today_revenue|default:0 }},
            count: {{ today_count|default:0 }},
            change: {{ today_change|default:0 }},
            dailyAvg: {{ today_daily_avg|default:0 }},
            chartData: {{ today_chart_data|safe }},
            chartLabels: {{ today_chart_labels|safe }}
        }
    };

    // Format number with commas
    function formatNumber(num) {
        return Math.round(num).toLocaleString('en-US');
    }

    // Global chart variable
    var ordersChart = null;

    // Create or update chart
    function updateChart(period) {
        const data = ordersData[period];
        
        const options = {
            series: [{
                name: 'Revenue',
                data: data.chartData
            }],
            chart: {
                height: 264,
                type: 'line',
                toolbar: {
                    show: false
                },
                zoom: {
                    enabled: false
                },
                dropShadow: {
                    enabled: true,
                    top: 6,
                    left: 0,
                    blur: 4,
                    color: '#000',
                    opacity: 0.1,
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                colors: ['#487FFF'],
                width: 3
            },
            markers: {
                size: 0,
                strokeWidth: 3,
                hover: {
                    size: 8
                }
            },
            tooltip: {
                enabled: true,
                x: {
                    show: true,
                },
                y: {
                    show: true,
                    formatter: function(value) {
                        return formatNumber(value) + ' UZS';
                    }
                },
                z: {
                    show: false,
                }
            },
            grid: {
                row: {
                    colors: ['transparent', 'transparent'],
                    opacity: 0.5
                },
                borderColor: '#D1D5DB',
                strokeDashArray: 3,
            },
            yaxis: {
                labels: {
                    formatter: function (value) {
                        if (value >= 1000000) {
                            return (value / 1000000).toFixed(1) + 'M';
                        } else if (value >= 1000) {
                            return (value / 1000).toFixed(0) + 'k';
                        }
                        return value;
                    },
                    style: {
                        fontSize: '14px'
                    }
                },
            },
            xaxis: {
                categories: data.chartLabels,
                tooltip: {
                    enabled: false
                },
                labels: {
                    formatter: function (value) {
                        return value;
                    },
                    style: {
                        fontSize: '14px'
                    }
                },
                axisBorder: {
                    show: false
                },
                crosshairs: {
                    show: true,
                    width: 20,
                    stroke: {
                        width: 0
                    },
                    fill: {
                        type: 'solid',
                        color: '#487FFF40',
                    }
                }
            }
        };

        // Destroy existing chart and create new one
        if (ordersChart) {
            ordersChart.destroy();
        }
        ordersChart = new ApexCharts(document.querySelector('#chart'), options);
        ordersChart.render();
    }

    // Update UI based on selected period
    function updateOrdersUI(period) {
        const data = ordersData[period];
        document.getElementById('ordersRevenue').textContent = formatNumber(data.revenue) + ' UZS';
        document.getElementById('ordersCount').textContent = formatNumber(data.count);
        document.getElementById('ordersChangeValue').textContent = data.change + '%';
        
        const badge = document.getElementById('ordersChangeBadge');
        const icon = document.getElementById('ordersChangeIcon');
        
        if (data.change >= 0) {
            badge.className = 'text-sm fw-semibold rounded-pill bg-success-focus text-success-main border br-success px-8 py-4 line-height-1';
            icon.setAttribute('icon', 'bxs:up-arrow');
        } else {
            badge.className = 'text-sm fw-semibold rounded-pill bg-danger-focus text-danger-main border br-danger px-8 py-4 line-height-1';
            icon.setAttribute('icon', 'bxs:down-arrow');
        }
        
        if (period === 'today') {
            document.getElementById('ordersDailyAvg').textContent = formatNumber(data.dailyAvg) + ' UZS Today';
        } else {
            document.getElementById('ordersDailyAvg').textContent = '+ ' + formatNumber(data.dailyAvg) + ' UZS Per Day';
        }

        // Update chart
        updateChart(period);
    }

    // Period selector event listener
    document.getElementById('ordersPeriodSelect').addEventListener('change', function() {
        updateOrdersUI(this.value);
    });

    // Initialize with yearly data
    updateOrdersUI('yearly');

    // =========================== Sales Statistic Line Chart End ===============================

    // ================================ Earning Statistics bar chart Start ================================
    var options = {
        series: [{
            name: 'Sales',
            data: [{
                x: 'Jan',
                y: 85000,
            }, {
                x: 'Feb',
                y: 70000,
            }, {
                x: 'Mar',
                y: 40000,
            }, {
                x: 'Apr',
                y: 50000,
            }, {
                x: 'May',
                y: 60000,
            }, {
                x: 'Jun',
                y: 50000,
            }, {
                x: 'Jul',
                y: 40000,
            }, {
                x: 'Aug',
                y: 50000,
            }, {
                x: 'Sep',
                y: 40000,
            }, {
                x: 'Oct',
                y: 60000,
            }, {
                x: 'Nov',
                y: 30000,
            }, {
                x: 'Dec',
                y: 50000,
            }]
        }],
        chart: {
            type: 'bar',
            height: 310,
            toolbar: {
                show: false
            }
        },
        plotOptions: {
            bar: {
                borderRadius: 4,
                horizontal: false,
                columnWidth: '23%',
                endingShape: 'rounded',
            }
        },
        dataLabels: {
            enabled: false
        },
        fill: {
            type: 'gradient',
            colors: ['#487FFF'], // Set the starting color (top color) here
            gradient: {
                shade: 'light', // Gradient shading type
                type: 'vertical', // Gradient direction (vertical)
                shadeIntensity: 0.5, // Intensity of the gradient shading
                gradientToColors: ['#487FFF'], // Bottom gradient color (with transparency)
                inverseColors: false, // Do not invert colors
                opacityFrom: 1, // Starting opacity
                opacityTo: 1, // Ending opacity
                stops: [0, 100],
            },
        },
        grid: {
            show: true,
            borderColor: '#D1D5DB',
            strokeDashArray: 4, // Use a number for dashed style
            position: 'back',
        },
        xaxis: {
            type: 'category',
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        yaxis: {
            labels: {
                formatter: function (value) {
                    return (value / 1000).toFixed(0) + 'k';
                }
            }
        },
        tooltip: {
            y: {
                formatter: function (value) {
                    return value / 1000 + 'k';
                }
            }
        }
    };

    var chart = new ApexCharts(document.querySelector('#barChart'), options);
    chart.render();
    // ================================ Earning Statistics bar chart End ================================

    // ================================ Order Status Donut Chart Start ================================
    // Status chart data from Django
    const statusChartData = {
        today: {
            labels: {{ status_chart_data.today.labels|safe }},
            values: {{ status_chart_data.today.values|safe }},
            colors: {{ status_chart_data.today.colors|safe }}
        },
        weekly: {
            labels: {{ status_chart_data.weekly.labels|safe }},
            values: {{ status_chart_data.weekly.values|safe }},
            colors: {{ status_chart_data.weekly.colors|safe }}
        },
        monthly: {
            labels: {{ status_chart_data.monthly.labels|safe }},
            values: {{ status_chart_data.monthly.values|safe }},
            colors: {{ status_chart_data.monthly.colors|safe }}
        },
        yearly: {
            labels: {{ status_chart_data.yearly.labels|safe }},
            values: {{ status_chart_data.yearly.values|safe }},
            colors: {{ status_chart_data.yearly.colors|safe }}
        }
    };

    var orderStatusChart = null;

    function updateStatusChart(period) {
        const data = statusChartData[period];
        const total = data.values.reduce((a, b) => a + b, 0);

        const options = {
            series: data.values,
            colors: data.colors,
            labels: data.labels,
            legend: {
                show: false
            },
            chart: {
                type: 'donut',
                height: 270,
                sparkline: {
                    enabled: true
                },
                margin: {
                    top: 0,
                    right: 0,
                    bottom: 0,
                    left: 0
                },
                padding: {
                    top: 0,
                    right: 0,
                    bottom: 0,
                    left: 0
                }
            },
            stroke: {
                width: 0,
            },
            dataLabels: {
                enabled: false
            },
            tooltip: {
                enabled: true,
                y: {
                    formatter: function(value, { seriesIndex }) {
                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                        return value + ' orders (' + percentage + '%)';
                    }
                }
            },
            plotOptions: {
                pie: {
                    donut: {
                        size: '65%',
                        labels: {
                            show: true,
                            total: {
                                show: true,
                                label: 'Total',
                                fontSize: '14px',
                                fontWeight: 600,
                                formatter: function(w) {
                                    return total;
                                }
                            }
                        }
                    }
                }
            },
            responsive: [{
                breakpoint: 480,
                options: {
                    chart: {
                        width: 200
                    },
                    legend: {
                        position: 'bottom'
                    }
                }
            }],
        };

        // Destroy existing chart and create new one
        if (orderStatusChart) {
            orderStatusChart.destroy();
        }
        orderStatusChart = new ApexCharts(document.querySelector('#orderStatusDonutChart'), options);
        orderStatusChart.render();

        // Update legend
        const legendContainer = document.getElementById('statusLegend');
        legendContainer.innerHTML = '';
        
        data.labels.forEach((label, index) => {
            const count = data.values[index];
            const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
            const color = data.colors[index];
            
            const li = document.createElement('li');
            li.className = 'd-flex align-items-center gap-2';
            li.innerHTML = `
                <span class="w-12-px h-12-px radius-2" style="background-color: ${color}"></span>
                <span class="text-secondary-light text-sm fw-normal">
                    ${label}: <span class="text-primary-light fw-semibold">${count}</span>
                    <span class="text-xs text-secondary-light">(${percentage}%)</span>
                </span>
            `;
            legendContainer.appendChild(li);
        });
    }

    // Period selector event listener for status chart
    document.getElementById('statusPeriodSelect').addEventListener('change', function() {
        updateStatusChart(this.value);
    });

    // Initialize with yearly data
    updateStatusChart('yearly');
    // ================================ Order Status Donut Chart End ================================

    // ================================ Top Agencies & Customers Tables Start ================================
    const topAgenciesData = {{ top_agencies_data|safe }};
    const topCustomersData = {{ top_customers_data|safe }};

    const rowColors = ['bg-primary-light', 'bg-success-focus', 'bg-info-focus', 'bg-warning-focus', 'bg-danger-focus'];

    function updateAgenciesTable(period) {
        const data = topAgenciesData[period];
        const tbody = document.getElementById('agenciesTableBody');
        const noDataMsg = document.getElementById('noAgenciesMessage');
        
        tbody.innerHTML = '';
        
        if (data.length === 0) {
            noDataMsg.classList.remove('d-none');
            return;
        }
        
        noDataMsg.classList.add('d-none');
        
        data.forEach((user, index) => {
            const bgClass = rowColors[index % rowColors.length];
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="${bgClass}"><strong>${index + 1}</strong></td>
                <td class="${bgClass}">
                    <div>
                        <h6 class="text-md mb-0 fw-medium">${user.name}</h6>
                        <span class="text-sm text-secondary-light">@${user.username}</span>
                    </div>
                </td>
                <td class="${bgClass}">
                    <span class="bg-primary-focus text-primary-main px-16 py-4 rounded-pill fw-medium text-sm">${user.order_count}</span>
                </td>
                <td class="${bgClass}">${formatNumber(user.total_spent)} UZS</td>
                <td class="${bgClass}">${formatNumber(user.total_pages)}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function updateCustomersTable(period) {
        const data = topCustomersData[period];
        const tbody = document.getElementById('customersTableBody');
        const noDataMsg = document.getElementById('noCustomersMessage');
        
        tbody.innerHTML = '';
        
        if (data.length === 0) {
            noDataMsg.classList.remove('d-none');
            return;
        }
        
        noDataMsg.classList.add('d-none');
        
        data.forEach((user, index) => {
            const bgClass = rowColors[index % rowColors.length];
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="${bgClass}"><strong>${index + 1}</strong></td>
                <td class="${bgClass}">
                    <div>
                        <h6 class="text-md mb-0 fw-medium">${user.name}</h6>
                        <span class="text-sm text-secondary-light">${user.phone !== '-' ? user.phone : '@' + user.username}</span>
                    </div>
                </td>
                <td class="${bgClass}">
                    <span class="bg-success-focus text-success-main px-16 py-4 rounded-pill fw-medium text-sm">${user.order_count}</span>
                </td>
                <td class="${bgClass}">${formatNumber(user.total_spent)} UZS</td>
                <td class="${bgClass}">${formatNumber(user.total_pages)}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Period selector event listeners
    document.getElementById('agenciesPeriodSelect').addEventListener('change', function() {
        updateAgenciesTable(this.value);
    });

    document.getElementById('customersPeriodSelect').addEventListener('change', function() {
        updateCustomersTable(this.value);
    });

    // Initialize with yearly data
    updateAgenciesTable('yearly');
    updateCustomersTable('yearly');
    // ================================ Top Agencies & Customers Tables End ================================

    // ================================ Client Payment Status chart End ================================
    var options = {
        series: [{
            name: 'Net Profit',
            data: [44, 100, 40, 56, 30, 58, 50]
        }, {
            name: 'Revenue',
            data: [90, 140, 80, 125, 70, 140, 110]
        }, {
            name: 'Free Cash',
            data: [60, 120, 60, 90, 50, 95, 90]
        }],
        colors: ['#45B369', '#144bd6', '#FF9F29'],
        labels: ['Active', 'New', 'Total'],

        legend: {
            show: false
        },
        chart: {
            type: 'bar',
            height: 350,
            toolbar: {
                show: false
            },
        },
        grid: {
            show: true,
            borderColor: '#D1D5DB',
            strokeDashArray: 4, // Use a number for dashed style
            position: 'back',
        },
        plotOptions: {
            bar: {
                borderRadius: 4,
                columnWidth: 8,
            },
        },
        dataLabels: {
            enabled: false
        },
        states: {
            hover: {
                filter: {
                    type: 'none'
                }
            }
        },
        stroke: {
            show: true,
            width: 0,
            colors: ['transparent']
        },
        xaxis: {
            categories: ['Mon', 'Tues', 'Wed', 'Thurs', 'Fri', 'Sat', 'Sun'],
        },
        yaxis: {
            categories: ['0', '10,000', '20,000', '30,000', '50,000', '1,00,000', '1,00,000'],
        },
        fill: {
            opacity: 1,
            width: 18,
        },
    };

    var chart = new ApexCharts(document.querySelector('#paymentStatusChart'), options);
    chart.render();
    // ================================ Client Payment Status chart End ================================

    // ================================ J Vector Map Start ================================
    $('#world-map').vectorMap({
        map: 'world_mill_en',
        backgroundColor: 'transparent',
        borderColor: '#fff',
        borderOpacity: 0.25,
        borderWidth: 0,
        color: '#000000',
        regionStyle: {
            initial: {
                fill: '#D1D5DB'
            }
        },
        markerStyle: {
            initial: {
                r: 5,
                'fill': '#fff',
                'fill-opacity': 1,
                'stroke': '#000',
                'stroke-width': 1,
                'stroke-opacity': 0.4
            },
        },
        markers: [{
            latLng: [35.8617, 104.1954],
            name: 'China : 250'
        },

        {
            latLng: [25.2744, 133.7751],
            name: 'AustrCalia : 250'
        },

        {
            latLng: [36.77, -119.41],
            name: 'USA : 82%'
        },

        {
            latLng: [55.37, -3.41],
            name: 'UK   : 250'
        },

        {
            latLng: [25.20, 55.27],
            name: 'UAE : 250'
        }
        ],

        series: {
            regions: [{
                values: {
                    'US': '#487FFF ',
                    'SA': '#487FFF',
                    'AU': '#487FFF',
                    'CN': '#487FFF',
                    'GB': '#487FFF',
                },
                attribute: 'fill'
            }]
        },
        hoverOpacity: null,
        normalizeFunction: 'linear',
        zoomOnScroll: false,
        scaleColors: ['#000000', '#000000'],
        selectedColor: '#000000',
        selectedRegions: [],
        enableZoom: false,
        hoverColor: '#fff',
    });
    // ================================ J Vector Map End ================================

    // ================================ Total Transaction line chart Start ================================
    var options = {
        series: [{
            name: 'This month',
            data: [4, 16, 12, 28, 22, 38, 23]
        }],
        chart: {
            height: 290,
            type: 'line',
            toolbar: {
                show: false
            },
            zoom: {
                enabled: false
            },
            dropShadow: {
                enabled: true,
                top: 6,
                left: 0,
                blur: 4,
                color: '#000',
                opacity: 0.1,
            },
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'smooth',
            width: 3
        },
        markers: {
            size: 0,
            strokeWidth: 3,
            hover: {
                size: 8
            }
        },
        tooltip: {
            enabled: true,
            x: {
                show: true,
            },
            y: {
                show: false,
            },
            z: {
                show: false,
            }
        },
        grid: {
            row: {
                colors: ['transparent', 'transparent'], // takes an array which will be repeated on columns
                opacity: 0.5
            },
            borderColor: '#D1D5DB',
            strokeDashArray: 3,
        },
        yaxis: {
            labels: {
                formatter: function (value) {
                    return '$' + value + 'k';
                },
                style: {
                    fontSize: '14px'
                }
            },
        },
        xaxis: {
            categories: ['Mon', 'Tues', 'Wed', 'Thurs', 'Fri', 'Sat', 'Sun'],
            tooltip: {
                enabled: false
            },
            labels: {
                formatter: function (value) {
                    return value;
                },
                style: {
                    fontSize: '14px'
                }
            },
            axisBorder: {
                show: false
            },
            crosshairs: {
                show: true,
                width: 20,
                stroke: {
                    width: 0
                },
                fill: {
                    type: 'solid',
                    color: '#B1B9C4',
                    gradient: {
                        colorFrom: '#D8E3F0',
                        colorTo: '#BED1E6',
                        stops: [0, 100],
                        opacityFrom: 0.4,
                        opacityTo: 0.5,
                    },
                }
            }
        }
    };

    var chart = new ApexCharts(document.querySelector('#transactionLineChart'), options);
    chart.render();
    // ================================ Total Transaction line chart End ================================

    // ================================ Semi Circle Gauge (Daily Conversion) chart Start ================================
    var options = {
        series: [75],
        chart: {
            height: 165,
            width: 120,
            type: 'radialBar',
            sparkline: {
                enabled: false // Remove whitespace
            },
            toolbar: {
                show: false
            },
            padding: {
                left: -32,
                right: -32,
                top: -32,
                bottom: -32
            },
            margin: {
                left: -32,
                right: -32,
                top: -32,
                bottom: -32
            }
        },
        plotOptions: {
            radialBar: {
                offsetY: -24,
                offsetX: -14,
                startAngle: -90,
                endAngle: 90,
                track: {
                    background: '#E3E6E9',
                    // strokeWidth: 32,
                    dropShadow: {
                        enabled: false,
                        top: 2,
                        left: 0,
                        color: '#999',
                        opacity: 1,
                        blur: 2
                    }
                },
                dataLabels: {
                    show: false,
                    name: {
                        show: false
                    },
                    value: {
                        offsetY: -2,
                        fontSize: '22px'
                    }
                }
            }
        },
        fill: {
            type: 'gradient',
            colors: ['#9DBAFF'],
            gradient: {
                shade: 'dark',
                type: 'horizontal',
                shadeIntensity: 0.5,
                gradientToColors: ['#487FFF'],
                inverseColors: true,
                opacityFrom: 1,
                opacityTo: 1,
                stops: [0, 100]
            }
        },
        stroke: {
            lineCap: 'round',
        },
        labels: ['Percent'],
    };

    var chart = new ApexCharts(document.querySelector('#semiCircleGauge'), options);
    chart.render();
    // ================================ Semi Circle Gauge (Daily Conversion) chart End ================================

    // ================================ Area chart Start ================================
    function createChart(chartId, chartColor) {

        let currentYear = new Date().getFullYear();

        var options = {
            series: [{
                name: 'series1',
                data: [0, 10, 8, 25, 15, 26, 13, 35, 15, 39, 16, 46, 42],
            },],
            chart: {
                type: 'area',
                width: 164,
                height: 72,

                sparkline: {
                    enabled: true // Remove whitespace
                },

                toolbar: {
                    show: false
                },
                padding: {
                    left: 0,
                    right: 0,
                    top: 0,
                    bottom: 0
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 2,
                colors: [chartColor],
                lineCap: 'round'
            },
            grid: {
                show: true,
                borderColor: 'transparent',
                strokeDashArray: 0,
                position: 'back',
                xaxis: {
                    lines: {
                        show: false
                    }
                },
                yaxis: {
                    lines: {
                        show: false
                    }
                },
                row: {
                    colors: undefined,
                    opacity: 0.5
                },
                column: {
                    colors: undefined,
                    opacity: 0.5
                },
                padding: {
                    top: -3,
                    right: 0,
                    bottom: 0,
                    left: 0
                },
            },
            fill: {
                type: 'gradient',
                colors: [chartColor], // Set the starting color (top color) here
                gradient: {
                    shade: 'light', // Gradient shading type
                    type: 'vertical', // Gradient direction (vertical)
                    shadeIntensity: 0.5, // Intensity of the gradient shading
                    gradientToColors: [`${chartColor}00`], // Bottom gradient color (with transparency)
                    inverseColors: false, // Do not invert colors
                    opacityFrom: .8, // Starting opacity
                    opacityTo: 0.3, // Ending opacity
                    stops: [0, 100],
                },
            },
            // Customize the circle marker color on hover
            markers: {
                colors: [chartColor],
                strokeWidth: 2,
                size: 0,
                hover: {
                    size: 8
                }
            },
            xaxis: {
                labels: {
                    show: false
                },
                categories: [`Jan ${currentYear}`, `Feb ${currentYear}`, `Mar ${currentYear}`, `Apr ${currentYear}`, `May ${currentYear}`, `Jun ${currentYear}`, `Jul ${currentYear}`, `Aug ${currentYear}`, `Sep ${currentYear}`, `Oct ${currentYear}`, `Nov ${currentYear}`, `Dec ${currentYear}`],
                tooltip: {
                    enabled: false,
                },
            },
            yaxis: {
                labels: {
                    show: false
                }
            },
            tooltip: {
                x: {
                    format: 'dd/MM/yy HH:mm'
                },
            },
        };

        var chart = new ApexCharts(document.querySelector(`#${chartId}`), options);
        chart.render();
    }

    // Call the function for each chart with the desired ID and color
    createChart('areaChart', '#FF9F29');
    // ================================ Area chart End ================================

    // ================================ Bar chart (Today Income0 Start ================================
    var options = {
        series: [{
            name: 'Sales',
            data: [{
                x: 'Mon',
                y: 20,
            }, {
                x: 'Tue',
                y: 40,
            }, {
                x: 'Wed',
                y: 20,
            }, {
                x: 'Thur',
                y: 30,
            }, {
                x: 'Fri',
                y: 40,
            }, {
                x: 'Sat',
                y: 35,
            }]
        }],
        chart: {
            type: 'bar',
            width: 164,
            height: 80,
            sparkline: {
                enabled: true // Remove whitespace
            },
            toolbar: {
                show: false
            }
        },
        plotOptions: {
            bar: {
                borderRadius: 6,
                horizontal: false,
                columnWidth: 14,
            }
        },
        dataLabels: {
            enabled: false
        },
        states: {
            hover: {
                filter: {
                    type: 'none'
                }
            }
        },
        fill: {
            type: 'gradient',
            colors: ['#E3E6E9'], // Set the starting color (top color) here
            gradient: {
                shade: 'light', // Gradient shading type
                type: 'vertical', // Gradient direction (vertical)
                shadeIntensity: 0.5, // Intensity of the gradient shading
                gradientToColors: ['#E3E6E9'], // Bottom gradient color (with transparency)
                inverseColors: false, // Do not invert colors
                opacityFrom: 1, // Starting opacity
                opacityTo: 1, // Ending opacity
                stops: [0, 100],
            },
        },
        grid: {
            show: false,
            borderColor: '#D1D5DB',
            strokeDashArray: 1, // Use a number for dashed style
            position: 'back',
        },
        xaxis: {
            labels: {
                show: false // Hide y-axis labels
            },
            type: 'category',
            categories: ['Mon', 'Tue', 'Wed', 'Thur', 'Fri', 'Sat']
        },
        yaxis: {
            labels: {
                show: false,
                formatter: function (value) {
                    return (value / 1000).toFixed(0) + 'k';
                }
            }
        },
        tooltip: {
            y: {
                formatter: function (value) {
                    return value / 1000 + 'k';
                }
            }
        }
    };

    var chart = new ApexCharts(document.querySelector('#dailyIconBarChart'), options);
    chart.render();
    // ================================ Bar chart (Today Income0 End ================================
</script>
{% endblock %}